{"version":3,"file":"index.js","sources":["../src/render-if-visible.tsx"],"sourcesContent":["import React, { useMemo, useState, useRef, useEffect } from 'react'\n\ntype Props = {\n  /**\n   * Whether the element should be visible initially or not.\n   * Useful e.g. for always setting the first N items to visible.\n   * Default: false\n   */\n  initialVisible?: boolean\n  /** An estimate of the element's height */\n  defaultHeight?: number\n  /** How far outside the viewport in pixels should elements be considered visible?  */\n  visibleOffset?: number\n  /** Should the element stay rendered after it becomes visible? */\n  stayRendered?: boolean\n  root?: HTMLElement | null\n  /** E.g. 'span', 'tbody'. Default = 'div' */\n  rootElement?: string\n  rootElementClass?: string\n  rootElementId?: string\n  /** E.g. 'span', 'tr'. Default = 'div' */\n  placeholderElement?: string\n  placeholderElementClass?: string\n  children: React.ReactNode\n}\n\nconst RenderIfVisible = ({\n  initialVisible = false,\n  defaultHeight = 300,\n  visibleOffset = 1000,\n  stayRendered = false,\n  root = null,\n  rootElement = 'div',\n  rootElementClass = '',\n  rootElementId = '',\n  placeholderElement = 'div',\n  placeholderElementClass = '',\n  children,\n}: Props) => {\n  const [isVisible, setIsVisible] = useState<boolean>(initialVisible)\n  const wasVisible = useRef<boolean>(initialVisible)\n  const placeholderHeight = useRef<number>(defaultHeight)\n  const intersectionRef = useRef<HTMLDivElement>(null)\n\n  // Set visibility with intersection observer\n  useEffect(() => {\n    if (intersectionRef.current) {\n      const localRef = intersectionRef.current\n      const observer = new IntersectionObserver(\n        (entries) => {\n          // Before switching off `isVisible`, set the height of the placeholder\n          if (!entries[0].isIntersecting) {\n            placeholderHeight.current = localRef!.offsetHeight\n          }\n          if (typeof window !== undefined && window.requestIdleCallback) {\n            window.requestIdleCallback(\n              () => setIsVisible(entries[0].isIntersecting),\n              {\n                timeout: 600,\n              }\n            )\n          } else {\n            setIsVisible(entries[0].isIntersecting)\n          }\n        },\n        { root, rootMargin: `${visibleOffset}px 0px ${visibleOffset}px 0px` }\n      )\n\n      observer.observe(localRef)\n      return () => {\n        if (localRef) {\n          observer.unobserve(localRef)\n        }\n      }\n    }\n    return () => {}\n  }, [])\n\n  useEffect(() => {\n    if (isVisible) {\n      wasVisible.current = true\n    }\n  }, [isVisible])\n\n  const placeholderStyle = { height: placeholderHeight.current }\n  const rootClasses = useMemo(\n    () => `renderIfVisible ${rootElementClass}`,\n    [rootElementClass]\n  )\n  const placeholderClasses = useMemo(\n    () => `renderIfVisible-placeholder ${placeholderElementClass}`,\n    [placeholderElementClass]\n  )\n\n  return React.createElement(rootElement, {\n    children: isVisible || (stayRendered && wasVisible.current) ? (\n      <>{children}</>\n    ) : (\n      React.createElement(placeholderElement, {\n        className: placeholderClasses,\n        style: placeholderStyle,\n      })\n    ),\n    ref: intersectionRef,\n    className: rootClasses,\n    id: rootElementId,\n  })\n}\n\nexport default RenderIfVisible\n"],"names":["useRef","useEffect","useMemo","React"],"mappings":";;;;;;;AA0BA,IAAM,eAAe,GAAG,UAAC,EAYjB;QAXN,sBAAsB,EAAtB,2CAAsB,EACtB,qBAAmB,EAAnB,wCAAmB,EACnB,qBAAoB,EAApB,yCAAoB,EACpB,oBAAoB,EAApB,yCAAoB,EACpB,YAAW,EAAX,gCAAW,EACX,mBAAmB,EAAnB,wCAAmB,EACnB,wBAAqB,EAArB,0CAAqB,EACrB,qBAAkB,EAAlB,uCAAkB,EAClB,0BAA0B,EAA1B,+CAA0B,EAC1B,+BAA4B,EAA5B,iDAA4B,EAC5B,sBAAQ;IAEF,IAAA,mCAA6D,EAA5D,iBAAS,EAAE,oBAAY,CAAqC;IACnE,IAAM,UAAU,GAAGA,YAAM,CAAU,cAAc,CAAC,CAAA;IAClD,IAAM,iBAAiB,GAAGA,YAAM,CAAS,aAAa,CAAC,CAAA;IACvD,IAAM,eAAe,GAAGA,YAAM,CAAiB,IAAI,CAAC,CAAA;;IAGpDC,eAAS,CAAC;QACR,IAAI,eAAe,CAAC,OAAO,EAAE;YAC3B,IAAM,UAAQ,GAAG,eAAe,CAAC,OAAO,CAAA;YACxC,IAAM,UAAQ,GAAG,IAAI,oBAAoB,CACvC,UAAC,OAAO;;gBAEN,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,cAAc,EAAE;oBAC9B,iBAAiB,CAAC,OAAO,GAAG,UAAS,CAAC,YAAY,CAAA;iBACnD;gBACD,IAAI,OAAO,MAAM,KAAK,SAAS,IAAI,MAAM,CAAC,mBAAmB,EAAE;oBAC7D,MAAM,CAAC,mBAAmB,CACxB,cAAM,OAAA,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,GAAA,EAC7C;wBACE,OAAO,EAAE,GAAG;qBACb,CACF,CAAA;iBACF;qBAAM;oBACL,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAA;iBACxC;aACF,EACD,EAAE,IAAI,MAAA,EAAE,UAAU,EAAK,aAAa,eAAU,aAAa,WAAQ,EAAE,CACtE,CAAA;YAED,UAAQ,CAAC,OAAO,CAAC,UAAQ,CAAC,CAAA;YAC1B,OAAO;gBACL,IAAI,UAAQ,EAAE;oBACZ,UAAQ,CAAC,SAAS,CAAC,UAAQ,CAAC,CAAA;iBAC7B;aACF,CAAA;SACF;QACD,OAAO,eAAQ,CAAA;KAChB,EAAE,EAAE,CAAC,CAAA;IAENA,eAAS,CAAC;QACR,IAAI,SAAS,EAAE;YACb,UAAU,CAAC,OAAO,GAAG,IAAI,CAAA;SAC1B;KACF,EAAE,CAAC,SAAS,CAAC,CAAC,CAAA;IAEf,IAAM,gBAAgB,GAAG,EAAE,MAAM,EAAE,iBAAiB,CAAC,OAAO,EAAE,CAAA;IAC9D,IAAM,WAAW,GAAGC,aAAO,CACzB,cAAM,OAAA,qBAAmB,gBAAkB,GAAA,EAC3C,CAAC,gBAAgB,CAAC,CACnB,CAAA;IACD,IAAM,kBAAkB,GAAGA,aAAO,CAChC,cAAM,OAAA,iCAA+B,uBAAyB,GAAA,EAC9D,CAAC,uBAAuB,CAAC,CAC1B,CAAA;IAED,OAAOC,cAAK,CAAC,aAAa,CAAC,WAAW,EAAE;QACtC,QAAQ,EAAE,SAAS,KAAK,YAAY,IAAI,UAAU,CAAC,OAAO,CAAC,IACzDA,4DAAG,QAAQ,CAAI,KAEfA,cAAK,CAAC,aAAa,CAAC,kBAAkB,EAAE;YACtC,SAAS,EAAE,kBAAkB;YAC7B,KAAK,EAAE,gBAAgB;SACxB,CAAC,CACH;QACD,GAAG,EAAE,eAAe;QACpB,SAAS,EAAE,WAAW;QACtB,EAAE,EAAE,aAAa;KAClB,CAAC,CAAA;AACJ,CAAC;;;;"}